<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ravenhill: The Case | Episode I</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∫–∏ –¥–∏–∑–∞–π–Ω–∞ –ø—Ä—è–º–æ –∑–¥–µ—Å—å –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏ */
        .choices { margin-bottom: 80px !important; gap: 20px; display: flex; justify-content: center; flex-wrap: wrap; }
        .task-question { width: 100%; text-align: center; font-weight: bold; color: #c7af8b; margin-bottom: 20px; }
        .clue-img { max-width: 100%; border-radius: 5px; border: 1px solid #333; }
    </style>
</head>
<body>

    <!-- 1. –°–¢–ê–†–¢–û–í–´–ô –≠–ö–†–ê–ù -->
    <div id="start-screen" class="start-screen">
        <h1 class="start-title">RAVENHILL</h1>
        <p class="start-subtitle">THE CASE: EPISODE I</p>
        <!-- –ü—Ä—è–º–æ–π –≤—ã–∑–æ–≤ —Ñ—É–Ω–∫—Ü–∏–∏ -->
        <button class="start-btn" onclick="startGame()">Enter the Manor</button>
    </div>

    <!-- 2. –ò–ì–†–û–í–û–ï –û–ö–ù–û -->
    <div id="game-container" class="game-content" style="display: none; max-width: 1000px; margin: 0 auto; padding: 20px;">
        <h2 id="scene-title" style="font-family: 'Cinzel', serif; color: #c7af8b;"></h2>
        <div id="media-container" style="margin-bottom: 20px;"></div>
        <div id="scene-text" style="font-size: 1.2rem; line-height: 1.6; margin-bottom: 30px;"></div>
        
        <!-- –ö–Ω–æ–ø–∫–∏ –æ—Ç–≤–µ—Ç–æ–≤ -->
        <div id="choices-container" class="choices"></div>

        <!-- –ü–∞–Ω–µ–ª–∏ -->
        <div class="panels-container" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <div class="mini-english" style="background: rgba(20,20,20,0.8); padding: 20px; border-top: 2px solid #c7af8b;">
                <h3 style="color: #c7af8b; font-family: 'Cinzel';">üîç Mini-English</h3>
                <div id="dictionary-display"></div>
            </div>
            <div class="status" style="background: rgba(20,20,20,0.8); padding: 20px; border-top: 2px solid #c7af8b;">
                <h3 style="color: #c7af8b; font-family: 'Cinzel';">üíº Status</h3>
                <div id="score-display">Score: 0</div>
                <div id="inventory-display">Inventory: empty</div>
            </div>
        </div>
    </div>

    <!-- 3. –ó–í–£–ö–ò -->
    <audio id="bgMusic" loop src="assets/mystery-loop.mp3"></audio>
    <audio id="uiClick" src="assets/click1.wav"></audio>
    <audio id="radioSound" src="assets/radio-message.wav"></audio>
    <audio id="footsteps" src="assets/footsteps.mp3"></audio>
    <audio id="diary-voice" src="assets/diary-voice.mp3"></audio>

    <!-- 4. –°–ö–†–ò–ü–¢ (–í–®–ò–¢ –í–ù–£–¢–†–¨ –î–õ–Ø –ì–ê–†–ê–ù–¢–ò–ò –†–ê–ë–û–¢–´) -->
    <script>
        let inventory = new Set();
        let score = 0;

        const itemNames = {
            'access_hint': 'üìú Radio Hint', 'silver_key': 'üóùÔ∏è Silver Key',
            'housekeeper_trust': 'ü§ù Housekeeper Trust', 'secret_code': 'üî¢ Secret Code',
            'basement_map': 'üó∫Ô∏è Basement Map', 'caretaker_key': 'üîë Cell Key',
            'trapdoor_open': 'üîì Trapdoor Unlocked'
        };

       function playSound(id) {
    const audio = document.getElementById(id);
    if (audio) {
        const soundClone = audio.cloneNode(); // –°–æ–∑–¥–∞–µ—Ç –∫–ª–æ–Ω –¥–ª—è –º–≥–Ω–æ–≤–µ–Ω–Ω–æ–≥–æ –∑–∞–ø—É—Å–∫–∞
        soundClone.volume = audio.volume;
        soundClone.play().catch(e => console.log("Playback failed"));
    }
}

        function updateStatus() {
            document.getElementById('score-display').innerText = `Score: ${score}`;
            const items = Array.from(inventory).map(id => itemNames[id] || id).join(', ');
            document.getElementById('inventory-display').innerText = `Inventory: ${items || 'empty'}`;
        }

        function startGame() {
    console.log("Game starting...");
    const startScreen = document.getElementById('start-screen');
    const gameContainer = document.getElementById('game-container');
    
    // –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≥—Ä–æ–º–∫–æ—Å—Ç–∏
    const bgMusic = document.getElementById('bgMusic');
    const diaryVoice = document.getElementById('diary-voice');
    const uiClick = document.getElementById('uiClick');

    if (bgMusic) {
        bgMusic.volume = 0.15; // –°–¥–µ–ª–∞–ª–∏ –µ—â–µ —á—É—Ç—å —Ç–∏—à–µ, —á—Ç–æ–±—ã –Ω–µ –ø–µ—Ä–µ–±–∏–≤–∞–ª–∞ –≥–æ–ª–æ—Å
        bgMusic.play().catch(e => console.log("Music blocked"));
    }
    if (diaryVoice) {
        diaryVoice.volume = 1.0; // –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è –≥—Ä–æ–º–∫–æ—Å—Ç—å –¥–ª—è —É–ª–∏–∫
    }
    if (uiClick) {
        uiClick.volume = 0.5; // –ö–ª–∏–∫–∏ –Ω–∞ —Å—Ä–µ–¥–Ω–µ–π –≥—Ä–æ–º–∫–æ—Å—Ç–∏
    }

    if (startScreen) startScreen.style.display = 'none';
    if (gameContainer) gameContainer.style.display = 'block';
    
    renderScene('scene1');
}


        const scenes = {
            scene1: {
                title: 'Episode I ¬∑ The Summons',
                text: 'You stand before the gates of Ravenhill. They are locked. You need to <b>find out</b> how to enter.',
                task: { question: 'What does "find out" mean?', options: ['To discover information', 'To close the gate'], correct: 'To discover information', reward: 'access_hint' },
                english: '<b>Find out</b> ‚Äî –≤—ã—è—Å–Ω–∏—Ç—å, —Ä–∞–∑—É–∑–Ω–∞—Ç—å.',
                media: '<img src="assets/gates.png" class="clue-img">',
                choices: [
                    { text: 'Search the Garden', next: 'scene_garden' },
                    { text: 'Use Radio Hint', next: 'scene_radio', require: 'access_hint' },
                    { text: 'Enter the Hall', next: 'scene2_hall', require: 'silver_key' }
                ]
            },
            scene_radio: {
                title: 'Radio Message',
                text: 'Static noise... then a voice: "Detective, check the garden!"',
                onEnter: () => playSound('radioSound'),
                media: '<video src="assets/radio-scene.mp4" autoplay loop muted class="clue-img" style="width:100%"></video>',
                choices: [{ text: 'Go to the Garden', next: 'scene_garden' }]
            },
            scene_garden: {
                title: 'The Silent Garden',
                text: 'Among the withered roses, you see a concealed wooden box.',
                media: '<img src="assets/garden.png" class="clue-img">',
                choices: [{ text: 'Open the box', next: 'scene_box_task' }]
            },
            scene_box_task: {
                title: 'The Mysterious Box',
                text: 'The box is locked. "The detective decided to _____ into the room."',
                task: { question: 'Which phrasal verb means "to enter"?', options: ['Go out', 'Go in'], correct: 'Go in', reward: 'silver_key' },
                media: '<img src="assets/box.png" class="clue-img">',
                choices: [{ text: 'Go back to Gates', next: 'scene1', require: 'silver_key' }]
            },
            scene2_hall: {
                title: 'The Grand Hall',
                text: 'The door creaks open. A terrified housekeeper stands by the stairs.',
                onEnter: () => playSound('footsteps'),
                media: '<video src="assets/hall-intro.mp4" autoplay loop muted class="clue-img" style="width:100%"></video>',
                choices: [{ text: 'Talk to her', next: 'scene_housekeeper' }]
            },
            scene_housekeeper: {
                title: 'The Housekeeper',
                text: '"Sir Henry _____ (watch) everyone for years!"',
                task: { question: 'Correct tense:', options: ['has been watching', 'is watching'], correct: 'has been watching', reward: 'housekeeper_trust' },
                media: '<img src="assets/housekeeper.png" class="clue-img">',
                choices: [{ text: 'Ask about the Portraits', next: 'scene_portrait_secret', require: 'housekeeper_trust' }]
            },
            scene_portrait_secret: {
                title: 'The Hidden Keypad',
                text: 'Behind the portrait, you find a keypad.',
                task: { question: 'Which is correct?', options: ['He must have been rich.', 'He must be rich yesterday.'], correct: 'He must have been rich.', reward: 'secret_code' },
                media: '<img src="assets/sir-henry.jpg" class="clue-img">',
                choices: [{ text: 'Open the Secret Study', next: 'scene_study', require: 'secret_code' }]
            },
            scene_study: {
                title: 'Sir Henry\'s Study',
                text: 'A secret room with a desk and an old diary.',
                media: '<img src="assets/study.png" class="clue-img">',
                choices: [
                    { text: 'Listen to the Diary', next: 'scene_diary' },
                    { text: 'Examine the Desk', next: 'scene_study_desk' }
                ]
            },
            scene_diary: {
                title: 'Elizabeth\'s Diary',
                text: 'You hear Elizabeth\'s voice...',
                onEnter: () => playSound('diary-voice'),
                media: '<img src="assets/diary-mystical.png" class="clue-img">',
                choices: [{ text: 'Back to Study', next: 'scene_study' }]
            },
            scene_study_desk: {
                title: 'The Mahogany Desk',
                text: 'A letter _____ (write) by Elizabeth lies here.',
                task: { question: 'Passive Voice:', options: ['was written', 'wrote'], correct: 'was written', reward: 'basement_map' },
                media: '<img src="assets/desk.png" class="clue-img">',
                choices: [{ text: 'Go to Basement', next: 'scene_basement', require: 'basement_map' }]
            },
            scene_basement: {
                title: 'The Basement',
                text: 'Suddenly, the door slams shut! You are trapped.',
                media: '<img src="assets/basement.png" class="clue-img">',
                choices: [{ text: 'Continue', next: 'scene_caretaker' }]
            },
            scene_caretaker: {
                title: 'The Caretaker',
                text: '"I wish you hadn\'t found that photo."',
                task: { question: 'B2 Regret:', options: ['hadn\'t found', 'didn\'t find'], correct: 'hadn\'t found', reward: 'caretaker_key' },
                media: '<img src="assets/caretaker.png" class="clue-img">',
                choices: [{ text: 'TO BE CONTINUED', next: 'scene_final', require: 'caretaker_key' }]
            },
            scene_final: { title: 'Mystery Continues', text: 'To be continued in Episode II...', choices: [{ text: 'Restart', next: 'scene1' }] }
        };

        function renderScene(sceneId) {
            const scene = scenes[sceneId];
            if (!scene) return;
            document.getElementById('scene-title').innerText = scene.title;
            document.getElementById('scene-text').innerHTML = scene.text;
            document.getElementById('media-container').innerHTML = scene.media || '';
            document.getElementById('dictionary-display').innerHTML = scene.english || 'Keep searching...';
            if (scene.onEnter) scene.onEnter();
            updateStatus();
            const choiceBox = document.getElementById('choices-container');
            choiceBox.innerHTML = '';
            if (scene.task && !inventory.has(scene.task.reward)) {
                renderTask(scene.task, choiceBox, sceneId);
            } else {
                scene.choices.forEach(c => {
                    if (!c.require || inventory.has(c.require)) {
                        const b = document.createElement('button');
                        b.className = 'choice-btn';
                        b.innerText = c.text;
                        b.onclick = () => { playSound('uiClick'); renderScene(c.next); };
                        choiceBox.appendChild(b);
                    }
                });
            }
        }

        function renderTask(task, container, sceneId) {
            const p = document.createElement('p');
            p.className = 'task-question';
            p.innerHTML = `TASK: ${task.question}`;
            container.appendChild(p);
            task.options.forEach(opt => {
                const b = document.createElement('button');
                b.className = 'choice-btn';
                b.innerText = opt;
                b.onclick = () => {
                    if (opt === task.correct) { 
                        score += 10; inventory.add(task.reward); renderScene(sceneId); 
                    } else { alert("Wrong! Check your grammar."); }
                };
                container.appendChild(b);
            });
        }
    </script>
</body>
</html>
