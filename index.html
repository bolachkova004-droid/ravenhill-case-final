<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ravenhill: The Case</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç—Å—Ç—É–ø–æ–≤ –∏ –≤–µ—Ä—Å—Ç–∫–∏ –º–µ–¥–∏–∞ */
        .choices { margin: 40px 0 80px 0 !important; gap: 15px; display: flex; justify-content: center; flex-wrap: wrap; width: 100%; }
        .clue-img { width: 100%; max-height: 450px; object-fit: cover; border-radius: 4px; display: block; margin: 0 auto 20px auto; background: #111; }
        .task-question { width: 100%; text-align: center; font-family: 'Cinzel', serif; color: #c7af8b; font-size: 1.1rem; margin-bottom: 20px; }
        #game-container { display: none; max-width: 900px; margin: 0 auto; padding: 20px; }
    </style>
</head>
<body>

    <!-- –°—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω -->
    <div id="start-screen" class="start-screen">
        <h1 class="start-title">RAVENHILL</h1>
        <p class="start-subtitle">THE CASE: EPISODE I</p>
        <button class="start-btn" onclick="startGame()">Enter the Manor</button>
    </div>

    <!-- –ò–≥—Ä–æ–≤–æ–µ –æ–∫–Ω–æ -->
    <div id="game-container">
        <div class="scene">
            <div class="case-file">Case File #01</div>
            <h2 id="scene-title"></h2>
            <div id="media-container"></div>
            <div id="scene-text"></div>
            <div id="choices-container" class="choices"></div>
        </div>

        <div class="panels-container" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <div class="mini-english" style="background: rgba(15,15,15,0.9); padding: 20px; border-top: 3px solid #c7af8b;">
                <h3 style="color:#c7af8b; font-family:'Cinzel';">üîç Mini-English</h3>
                <div id="dictionary-display"></div>
            </div>
            <div class="status" style="background: rgba(15,15,15,0.9); padding: 20px; border-top: 3px solid #c7af8b;">
                <h3 style="color:#c7af8b; font-family:'Cinzel';">üíº Status</h3>
                <div id="score-display">Score: 0</div>
                <div id="inventory-display">Inventory: empty</div>
            </div>
        </div>
    </div>

    <!-- –ó–≤—É–∫–∏ -->
    <audio id="bgMusic" loop src="assets/mystery-loop.mp3" preload="auto"></audio>
    <audio id="uiClick" src="assets/click1.wav" preload="auto"></audio>
    <audio id="radioSound" src="assets/radio-message.wav" preload="auto"></audio>
    <audio id="footsteps" src="assets/footsteps.mp3" preload="auto"></audio>
    <audio id="diary-voice" src="assets/diary-voice.mp3" preload="auto"></audio>

    <script>
        // --- 1. –ò–ù–ò–¶–ò–ê–õ–ò–ó–ê–¶–ò–Ø –ò –°–û–°–¢–û–Ø–ù–ò–ï ---
let inventory = new Set();
let score = 0;

// –ü–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –Ω–∞–∑–≤–∞–Ω–∏–π –ø—Ä–µ–¥–º–µ—Ç–æ–≤ –¥–ª—è Episode I
const itemNames = {
    'access_hint': 'üìú Radio Hint',
    'silver_key': 'üóùÔ∏è Silver Key',
    'housekeeper_trust': 'ü§ù Housekeeper Trust',
    'library_clue': 'üìñ Library Note',
    'poison_clue': 'üß™ Poison Residue',
    'secret_code': 'üî¢ Secret Code',
    'diary_unlocked': 'üìì Elizabeth\'s Diary',
    'caretaker_trust': 'üîë Caretaker\'s Trust'
};

function updateStatus() {
    const scoreDisplay = document.getElementById('score-display');
    const invDisplay = document.getElementById('inventory-display');
    
    if (scoreDisplay) scoreDisplay.innerText = `Score: ${score} points`;
    
    if (invDisplay) {
        // –ü—Ä–µ–≤—Ä–∞—â–∞–µ–º Set –≤ —Å–ø–∏—Å–æ–∫ –∫—Ä–∞—Å–∏–≤—ã—Ö –Ω–∞–∑–≤–∞–Ω–∏–π —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é
        const displayItems = Array.from(inventory)
            .map(id => itemNames[id] || id)
            .join(', ');
        invDisplay.innerText = `Inventory: ${displayItems || 'empty'}`;
    }
}

        function playSound(id) {
            const audio = document.getElementById(id);
            if (audio) {
                audio.pause();
                audio.currentTime = 0;
                audio.play().catch(e => console.log("Audio blocked"));
            }
        }

        function updateStatus() {
            document.getElementById('score-display').innerText = `Score: ${score}`;
            const items = Array.from(inventory).map(id => itemNames[id] || id).join(', ');
            document.getElementById('inventory-display').innerText = `Inventory: ${items || 'empty'}`;
        }

        function startGame() {
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('game-container').style.display = 'block';
            
            const music = document.getElementById('bgMusic');
            if (music) { music.volume = 0.15; music.play(); }
            
            renderScene('scene1');
        }

   const scenes = {
    // --- –ì–õ–ê–í–ê 1: –ü–†–ò–ë–´–¢–ò–ï ---
    scene1: {
        title: 'The Iron Gates',
        text: 'The manor looms ahead. To proceed, you must analyze the situation.',
        task: { 
            question: 'Task 1: What is the synonym of "investigate"?', 
            options: ['Look into', 'Look for', 'Look after'], 
            correct: 'Look into', 
            reward: 'gate_clue_1' 
        },
        media: '<img src="assets/gates.png" class="clue-img">',
        choices: [{ text: 'Continue Investigation', next: 'scene1_task2', require: 'gate_clue_1' }]
    },
    scene1_task2: {
        title: 'The Gate Mechanism',
        text: 'The lock is rusted. "It ____ (not/open) for years," you observe.',
        task: { 
            question: 'Task 2: Choose the correct Passive Voice:', 
            options: ['hasn\'t been opened', 'wasn\'t open', 'isn\'t opened'], 
            correct: 'hasn\'t been opened', 
            reward: 'gate_clue_2' 
        },
        choices: [{ text: 'Examine the Plaque', next: 'scene1_task3', require: 'gate_clue_2' }]
    },
    scene1_task3: {
        title: 'The Private Plaque',
        text: 'The plaque says: "Visitors ____ (request) to ring the bell."',
        task: { 
            question: 'Task 3: Formal Passive Structure:', 
            options: ['are requested', 'request', 'were requested'], 
            correct: 'are requested', 
            reward: 'access_hint' 
        },
        choices: [{ text: 'Go to the Garden', next: 'scene_garden', require: 'access_hint' }]
    },

    // --- –ì–õ–ê–í–ê 2: –°–ê–î –ò –ö–û–†–û–ë–ö–ê ---
    scene_box_task: {
        title: 'The Puzzle Box',
        text: 'The box has three mechanical layers. Layer 1: "If I ____ (be) you, I wouldn\'t touch that."',
        task: { 
            question: 'Layer 1: Conditional Type 2:', 
            options: ['were', 'am', 'would be'], 
            correct: 'were', 
            reward: 'box_1' 
        },
        media: '<img src="assets/box.png" class="clue-img">',
        choices: [{ text: 'Unlock Layer 2', next: 'scene_box_task2', require: 'box_1' }]
    },
    scene_box_task2: {
        title: 'The Puzzle Box - Layer 2',
        text: 'Layer 2: "The key ____ (hide) here by Elizabeth herself."',
        task: { 
            question: 'Layer 2: Passive Voice Deduction:', 
            options: ['must have been hidden', 'was hiding', 'has hidden'], 
            correct: 'must have been hidden', 
            reward: 'box_2' 
        },
        choices: [{ text: 'Unlock Final Layer', next: 'scene_box_task3', require: 'box_2' }]
    },
    scene_box_task3: {
        title: 'The Puzzle Box - Final Layer',
        text: 'Layer 3: "I wish I ____ (know) the truth earlier."',
        task: { 
            question: 'Layer 3: Wish about the past:', 
            options: ['had known', 'knew', 'would know'], 
            correct: 'had known', 
            reward: 'silver_key' 
        },
        choices: [{ text: 'Enter the Main Hall', next: 'scene2_hall', require: 'silver_key' }]
    },

    // --- –ì–õ–ê–í–ê 3: –ë–ò–ë–õ–ò–û–¢–ï–ö–ê (–ê–Ω–∞–ª–∏–∑ —Ç–µ–∫—Å—Ç–æ–≤) ---
    scene_library: {
        title: 'The Library',
        text: 'You find an old diary entry. Task 1: Identify the mood.',
        task: { 
            question: 'Elizabeth writes: "I am dreading his return." She is:', 
            options: ['Anxious/Fearful', 'Excited/Happy', 'Bored'], 
            correct: 'Anxious/Fearful', 
            reward: 'lib_1' 
        },
        media: '<img src="assets/library.png" class="clue-img">',
        choices: [{ text: 'Read more', next: 'scene_library_2', require: 'lib_1' }]
    },
    scene_library_2: {
        title: 'The Library - Secret Note',
        text: '"He ____ (must/work) for the enemy," the note suggests.',
        task: { 
            question: 'Task 2: Modal of deduction (Present Continuous):', 
            options: ['must be working', 'must work', 'must have worked'], 
            correct: 'must be working', 
            reward: 'lib_2' 
        },
        choices: [{ text: 'Analyze the map', next: 'scene_library_3', require: 'lib_2' }]
    },
    scene_library_3: {
        title: 'The Library - Hidden Map',
        text: 'The map shows a trapdoor. "It ____ (locate) under the mahogany desk."',
        task: { 
            question: 'Task 3: Present Passive:', 
            options: ['is located', 'locates', 'was located'], 
            correct: 'is located', 
            reward: 'library_clue' 
        },
        choices: [{ text: 'Return to Hall', next: 'scene2_hall', require: 'library_clue' }]
    },

    // --- –§–ò–ù–ê–õ: –ß–ï–†–î–ê–ö –ò –≠–õ–ò–ó–ê–ë–ï–¢ ---
    scene_elizabeth_reveal: {
        title: 'The Reveal',
        text: 'Elizabeth whispers three secrets. Secret 1: "I ____ (wait) for you for hours!"',
        task: { 
            question: 'Task 1: Present Perfect Continuous:', 
            options: ['have been waiting', 'am waiting', 'was waiting'], 
            correct: 'have been waiting', 
            reward: 'eliz_1' 
        },
        media: '<img src="assets/elizabeth.png" class="clue-img">',
        choices: [{ text: 'Listen to Secret 2', next: 'scene_eliz_2', require: 'eliz_1' }]
    },
    scene_eliz_2: {
        title: 'The Reveal - Secret 2',
        text: '"If you hadn\'t come, I ____ (be) lost."',
        task: { 
            question: 'Task 2: Mixed Conditional:', 
            options: ['would be', 'will be', 'am'], 
            correct: 'would be', 
            reward: 'eliz_2' 
        },
        choices: [{ text: 'Listen to Final Secret', next: 'scene_eliz_3', require: 'eliz_2' }]
    },
    scene_eliz_3: {
        title: 'The Reveal - Final Secret',
        text: '"It\'s time to leave. We ____ (follow) as we speak!"',
        task: { 
            question: 'Task 3: Present Continuous Passive:', 
            options: ['are being followed', 'are followed', 'were followed'], 
            correct: 'are being followed', 
            reward: 'final_clue' 
        },
        choices: [{ text: 'ESCAPE TOGETHER', next: 'scene_final', require: 'final_clue' }]
    },

    scene_final: { title: 'Episode I Complete', text: 'Masterfully done, Detective! Elizabeth is safe... for now.', choices: [{ text: 'Restart', next: 'scene1' }] }
};



        function renderScene(sceneId) {
            const scene = scenes[sceneId];
            if (!scene) return;

            document.getElementById('scene-title').innerText = scene.title;
            document.getElementById('scene-text').innerHTML = scene.text;
            document.getElementById('media-container').innerHTML = scene.media || '';
            document.getElementById('dictionary-display').innerHTML = scene.english || 'No new words here.';
            
            if (scene.onEnter) scene.onEnter();
            updateStatus();

            const choicesContainer = document.getElementById('choices-container');
            choicesContainer.innerHTML = '';

            if (scene.task && !inventory.has(scene.task.reward)) {
                renderTask(scene.task, choicesContainer, sceneId);
            } else {
                scene.choices.forEach(choice => {
                    if (!choice.require || inventory.has(choice.require)) {
                        const btn = document.createElement('button');
                        btn.innerText = choice.text;
                        btn.className = 'choice-btn';
                        btn.onclick = () => { playSound('uiClick'); renderScene(choice.next); };
                        choicesContainer.appendChild(btn);
                    }
                });
            }
        }

        function renderTask(task, container, sceneId) {
            const q = document.createElement('p');
            q.className = 'task-question';
            q.innerHTML = `TASK: ${task.question}`;
            container.appendChild(q);

            task.options.forEach(opt => {
                const btn = document.createElement('button');
                btn.innerText = opt;
                btn.className = 'choice-btn';
                btn.onclick = () => {
                    playSound('uiClick');
                    if (opt === task.correct) {
                        inventory.add(task.reward);
                        score += 10;
                        renderScene(sceneId);
                    } else { alert("Wrong answer!"); }
                };
                container.appendChild(btn);
            });
        }
    </script>
</body>
</html>
