<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ravenhill: The Case</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç—Å—Ç—É–ø–æ–≤ –∏ –≤–µ—Ä—Å—Ç–∫–∏ –º–µ–¥–∏–∞ */
        .choices { margin: 40px 0 80px 0 !important; gap: 15px; display: flex; justify-content: center; flex-wrap: wrap; width: 100%; }
        .clue-img { width: 100%; max-height: 450px; object-fit: cover; border-radius: 4px; display: block; margin: 0 auto 20px auto; background: #111; }
        .task-question { width: 100%; text-align: center; font-family: 'Cinzel', serif; color: #c7af8b; font-size: 1.1rem; margin-bottom: 20px; }
        #game-container { display: none; max-width: 900px; margin: 0 auto; padding: 20px; }
    </style>
</head>
<body>

    <!-- –°—Ç–∞—Ä—Ç–æ–≤—ã–π —ç–∫—Ä–∞–Ω -->
    <div id="start-screen" class="start-screen">
        <h1 class="start-title">RAVENHILL</h1>
        <p class="start-subtitle">THE CASE: EPISODE I</p>
        <button class="start-btn" onclick="startGame()">Enter the Manor</button>
    </div>

    <!-- –ò–≥—Ä–æ–≤–æ–µ –æ–∫–Ω–æ -->
    <div id="game-container">
        <div class="scene">
            <div class="case-file">Case File #01</div>
            <h2 id="scene-title"></h2>
            <div id="media-container"></div>
            <div id="scene-text"></div>
            <div id="choices-container" class="choices"></div>
        </div>

        <div class="panels-container" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <div class="mini-english" style="background: rgba(15,15,15,0.9); padding: 20px; border-top: 3px solid #c7af8b;">
                <h3 style="color:#c7af8b; font-family:'Cinzel';">üîç Mini-English</h3>
                <div id="dictionary-display"></div>
            </div>
            <div class="status" style="background: rgba(15,15,15,0.9); padding: 20px; border-top: 3px solid #c7af8b;">
                <h3 style="color:#c7af8b; font-family:'Cinzel';">üíº Status</h3>
                <div id="score-display">Score: 0</div>
                <div id="inventory-display">Inventory: empty</div>
            </div>
        </div>
    </div>

    <!-- –ó–≤—É–∫–∏ -->
    <audio id="bgMusic" loop src="assets/mystery-loop.mp3" preload="auto"></audio>
    <audio id="uiClick" src="assets/click1.wav" preload="auto"></audio>
    <audio id="radioSound" src="assets/radio-message.wav" preload="auto"></audio>
    <audio id="footsteps" src="assets/footsteps.mp3" preload="auto"></audio>
    <audio id="diary-voice" src="assets/diary-voice.mp3" preload="auto"></audio>

    <script>
        let inventory = new Set();
        let score = 0;

        const itemNames = {
            'access_hint': 'üìú Radio Hint', 'silver_key': 'üóùÔ∏è Silver Key',
            'housekeeper_trust': 'ü§ù Housekeeper Trust', 'secret_code': 'üî¢ Secret Code',
            'library_clue': 'üìñ Library Note', 'poison_clue': 'üß™ Kitchen Clue'
        };

        function playSound(id) {
            const audio = document.getElementById(id);
            if (audio) {
                audio.pause();
                audio.currentTime = 0;
                audio.play().catch(e => console.log("Audio blocked"));
            }
        }

        function updateStatus() {
            document.getElementById('score-display').innerText = `Score: ${score}`;
            const items = Array.from(inventory).map(id => itemNames[id] || id).join(', ');
            document.getElementById('inventory-display').innerText = `Inventory: ${items || 'empty'}`;
        }

        function startGame() {
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('game-container').style.display = 'block';
            
            const music = document.getElementById('bgMusic');
            if (music) { music.volume = 0.15; music.play(); }
            
            renderScene('scene1');
        }

     const scenes = {
    // --- –ì–õ–ê–í–ê 1: –ü–†–ò–ë–´–¢–ò–ï ---
    scene1: {
        title: 'The Gates',
        text: 'You stand before the gates of Ravenhill Manor. They are locked. You need to <b>find out</b> how to enter.',
        task: { 
            question: 'What does "find out" mean?', 
            options: ['To discover information', 'To close the gate'], 
            correct: 'To discover information', 
            reward: 'access_hint' 
        },
        english: '<b>Find out</b> ‚Äî –≤—ã—è—Å–Ω–∏—Ç—å, —Ä–∞–∑—É–∑–Ω–∞—Ç—å.',
        media: '<img src="assets/gates.png" class="clue-img">',
        choices: [
            { text: 'Search the Garden', next: 'scene_garden' },
            { text: 'Use Radio Hint', next: 'scene_radio', require: 'access_hint' },
            { text: 'Enter the Hall', next: 'scene2_hall', require: 'silver_key' }
        ]
    },
    scene_radio: {
        title: 'Radio Message',
        text: 'Static noise... then a voice: "Detective, check the garden! There is a box hidden near the roses."',
        onEnter: () => playSound('radioSound'),
        media: '<video src="assets/radio-scene.mp4" autoplay loop muted class="clue-img"></video>',
        choices: [{ text: 'Go to the Garden', next: 'scene_garden' }]
    },
    scene_garden: {
        title: 'The Silent Garden',
        text: 'Among the withered roses, you see a <span class="vocab-word">concealed</span> wooden box.',
        english: '<b>Concealed</b> ‚Äî —Å–∫—Ä—ã—Ç—ã–π, —Å–ø—Ä—è—Ç–∞–Ω–Ω—ã–π.',
        media: '<img src="assets/garden.png" class="clue-img">',
        choices: [{ text: 'Open the box', next: 'scene_box_task' }]
    },
    scene_box_task: {
        title: 'The Mysterious Box',
        text: 'The box is locked. "The detective decided to _____ into the room."',
        task: { 
            question: 'Which phrasal verb means "to enter"?', 
            options: ['Go out', 'Go in'], 
            correct: 'Go in', 
            reward: 'silver_key' 
        },
        media: '<img src="assets/box.png" class="clue-img">',
        choices: [{ text: 'Go to Gates with Key', next: 'scene1', require: 'silver_key' }]
    },

    // --- –ì–õ–ê–í–ê 2: –û–°–û–ë–ù–Ø–ö –ò –£–õ–ò–ö–ò ---
    scene2_hall: {
        title: 'The Grand Hall',
        text: 'The manor is vast. You must gather clues to find Sir Henry. Where will you investigate?',
        media: '<video src="assets/hall-intro.mp4" autoplay loop muted class="clue-img"></video>',
        choices: [
            { text: 'Go to the Library', next: 'scene_library' },
            { text: 'Check the Kitchen', next: 'scene_kitchen' },
            { text: 'Talk to the Housekeeper', next: 'scene_housekeeper' },
            { text: 'Examine the Portrait', next: 'scene_portrait_secret', require: 'housekeeper_trust' }
        ]
    },
    scene_library: {
        title: 'The Library',
        text: 'Dusty books line the walls. "If Sir Henry ____ (be) more careful, he wouldn\'t be missing now."',
        task: { 
            question: 'Mixed Conditional (B2):', 
            options: ['had been', 'was', 'would be'], 
            correct: 'had been', 
            reward: 'library_clue' 
        },
        media: '<img src="assets/library.png" class="clue-img">',
        choices: [{ text: 'Back to Hall', next: 'scene2_hall' }]
    },
    scene_kitchen: {
        title: 'The Kitchen',
        text: 'A silver tray ____ (leave) on the counter. It smells of bitter almonds‚Äîpoison.',
        task: { 
            question: 'Passive Voice (B2):', 
            options: ['must have been left', 'has left'], 
            correct: 'must have been left', 
            reward: 'poison_clue' 
        },
        media: '<img src="assets/kitchen.png" class="clue-img">',
        choices: [{ text: 'Back to Hall', next: 'scene2_hall' }]
    },
    scene_housekeeper: {
        title: 'The Housekeeper',
        text: '"You shouldn\'t be here! Sir Henry _____ (watch) everyone for years!"',
        task: { 
            question: 'Present Perfect Continuous:', 
            options: ['has been watching', 'is watching'], 
            correct: 'has been watching', 
            reward: 'housekeeper_trust' 
        },
        media: '<img src="assets/housekeeper.png" class="clue-img">',
        choices: [{ text: 'Back to Hall', next: 'scene2_hall' }]
    },

    // --- –ì–õ–ê–í–ê 3: –¢–ê–ô–ù–´–ô –ö–ê–ë–ò–ù–ï–¢ ---
    scene_portrait_secret: {
        title: 'The Hidden Keypad',
        text: 'Behind the portrait, you find a keypad. "He must ____ (be) rich to afford this."',
        task: { 
            question: 'Modal Deduction (B2):', 
            options: ['have been', 'had been'], 
            correct: 'have been', 
            reward: 'secret_code' 
        },
        media: '<img src="assets/sir-henry.jpg" class="clue-img">',
        choices: [{ text: 'Enter the Secret Study', next: 'scene_study', require: 'secret_code' }]
    },
    scene_study: {
        title: 'Sir Henry\'s Study',
        text: 'A hidden room with a mahogany desk. You see Elizabeth\'s diary.',
        media: '<img src="assets/study.png" class="clue-img">',
        choices: [{ text: 'Examine the Desk', next: 'scene_study_desk' }]
    },
    scene_study_desk: {
        title: 'The Desk',
        text: 'On the desk lies Elizabeth\'s diary. It seems she ____ (write) in it recently.',
        task: { 
            question: 'Past Perfect:', 
            options: ['had written', 'wrote'], 
            correct: 'had written', 
            reward: 'diary_unlocked' 
        },
        media: '<img src="assets/desk.png" class="clue-img">',
        choices: [{ text: 'Listen to the Diary', next: 'scene_diary', require: 'diary_unlocked' }]
    },
    scene_diary: {
        title: 'Elizabeth\'s Diary',
        text: 'Voice: "The Caretaker is watching... Find the trapdoor!"',
        onEnter: () => playSound('diary-voice'),
        media: '<img src="assets/diary-mystical.png" class="clue-img">',
        choices: [{ text: 'Find the Trapdoor', next: 'scene_trapdoor', require: 'library_clue' }]
    },

    // --- –ì–õ–ê–í–ê 4: –ü–û–î–í–ê–õ –ò –§–ò–ù–ê–õ ---
    scene_trapdoor: {
        title: 'The Trapdoor',
        text: 'A hidden passage leads down into the darkness.',
        media: '<img src="assets/trapdoor.png" class="clue-img">',
        choices: [{ text: 'Go down to the Basement', next: 'scene_basement' }]
    },
    scene_basement: {
        title: 'The Basement',
        text: 'Suddenly, the door slams shut! You are trapped.',
        media: '<img src="assets/basement.png" class="clue-img">',
        choices: [{ text: 'Who is there?', next: 'scene_caretaker' }]
    },
    scene_caretaker: {
        title: 'The Caretaker',
        text: '"I wish you ____ (not/find) this place," says the old man.',
        task: { 
            question: 'B2 Regrets (Wish):', 
            options: ['hadn\'t found', 'didn\'t find'], 
            correct: 'hadn\'t found', 
            reward: 'caretaker_trust' 
        },
        media: '<img src="assets/caretaker.png" class="clue-img">',
        choices: [{ text: 'Ask about Elizabeth', next: 'scene_attic', require: 'caretaker_trust' }]
    },
    scene_attic: {
        title: 'The Attic',
        text: 'You climb to the top. In the moonlight, you see a figure.',
        onEnter: () => playSound('footsteps'),
        media: '<img src="assets/attic.png" class="clue-img">',
        choices: [{ text: 'Approach Elizabeth', next: 'scene_elizabeth_reveal' }]
    },
    scene_elizabeth_reveal: {
        title: 'Elizabeth',
        text: '"Detective? You found me. But we aren\'t safe... We must leave. Now."',
        media: '<img src="assets/elizabeth.png" class="clue-img">',
        choices: [{ text: 'FINISH EPISODE I', next: 'scene_final' }]
    },
    scene_final: {
        title: 'To Be Continued',
        text: 'Episode II: The Shadow of Ravenhill ‚Äî Coming Soon.',
        choices: [{ text: 'Restart Adventure', next: 'scene1' }]
    }
};

        function renderScene(sceneId) {
            const scene = scenes[sceneId];
            if (!scene) return;

            document.getElementById('scene-title').innerText = scene.title;
            document.getElementById('scene-text').innerHTML = scene.text;
            document.getElementById('media-container').innerHTML = scene.media || '';
            document.getElementById('dictionary-display').innerHTML = scene.english || 'No new words here.';
            
            if (scene.onEnter) scene.onEnter();
            updateStatus();

            const choicesContainer = document.getElementById('choices-container');
            choicesContainer.innerHTML = '';

            if (scene.task && !inventory.has(scene.task.reward)) {
                renderTask(scene.task, choicesContainer, sceneId);
            } else {
                scene.choices.forEach(choice => {
                    if (!choice.require || inventory.has(choice.require)) {
                        const btn = document.createElement('button');
                        btn.innerText = choice.text;
                        btn.className = 'choice-btn';
                        btn.onclick = () => { playSound('uiClick'); renderScene(choice.next); };
                        choicesContainer.appendChild(btn);
                    }
                });
            }
        }

        function renderTask(task, container, sceneId) {
            const q = document.createElement('p');
            q.className = 'task-question';
            q.innerHTML = `TASK: ${task.question}`;
            container.appendChild(q);

            task.options.forEach(opt => {
                const btn = document.createElement('button');
                btn.innerText = opt;
                btn.className = 'choice-btn';
                btn.onclick = () => {
                    playSound('uiClick');
                    if (opt === task.correct) {
                        inventory.add(task.reward);
                        score += 10;
                        renderScene(sceneId);
                    } else { alert("Wrong answer!"); }
                };
                container.appendChild(btn);
            });
        }
    </script>
</body>
</html>
