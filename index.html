<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ravenhill: The Case | Episode I</title>
    <link rel="stylesheet" href="style.css">
    <style>
        #game-container { animation: fadeIn 0.8s ease-in-out; max-width: 900px; margin: 0 auto; padding: 20px; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        .choices { margin: 30px 0 80px 0 !important; gap: 15px; display: flex; justify-content: center; flex-wrap: wrap; width: 100%; }
        .clue-img { width: 100%; max-height: 50vh; object-fit: contain; border-radius: 4px; display: block; margin: 0 auto 20px auto; background: #050505; border: 1px solid rgba(199, 175, 139, 0.2); }
        .task-question { width: 100%; text-align: center; font-family: 'Cinzel', serif; color: #c7af8b; font-size: 1.1rem; margin-bottom: 20px; background: rgba(199, 175, 139, 0.1); padding: 15px; border-radius: 4px; border: 1px dashed #c7af8b; }
    </style>
</head>
<body>

    <div id="start-screen" class="start-screen">
        <h1 class="start-title">RAVENHILL</h1>
        <p class="start-subtitle">THE CASE: EPISODE I</p>
        <button class="start-btn" onclick="startGame()">Enter the Manor</button>
    </div>

    <div id="game-container" style="display: none;">
        <div class="scene">
            <div class="case-file">Case File #01</div>
            <h2 id="scene-title"></h2>
            <div id="media-container"></div>
            <div id="scene-text"></div>
            <div id="choices-container" class="choices"></div>
        </div>

        <div class="panels-container" style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <div class="mini-english" style="background: rgba(15,15,15,0.9); padding: 20px; border-top: 3px solid #c7af8b;">
                <h3 style="color:#c7af8b; font-family:'Cinzel';">üîç Mini-English</h3>
                <div id="dictionary-display"></div>
            </div>
            <div class="status" style="background: rgba(15,15,15,0.9); padding: 20px; border-top: 3px solid #c7af8b;">
                <h3 style="color:#c7af8b; font-family:'Cinzel';">üíº Status</h3>
                <div id="score-display">Score: 0 points</div>
                <div id="inventory-display">Inventory: empty</div>
            </div>
        </div>
    </div>

    <audio id="bgMusic" loop src="assets/mystery-loop.mp3"></audio>
    <audio id="uiClick" src="assets/click1.wav"></audio>
    <audio id="radioSound" src="assets/radio-message.wav"></audio>
    <audio id="footsteps" src="assets/footsteps.mp3"></audio>
    <audio id="diary-voice" src="assets/diary-voice.mp3"></audio>

    <script>
        let inventory = new Set();
        let score = 0;

      const itemNames = {
    'gate_1': 'üîç Gate Clue', 'gate_2': '‚öôÔ∏è Lock Hint', 'gate_clue': 'üìú Entry Permit',
    'garden_1': 'üåπ Rose Petal', 'box_1': 'üîì Layer 1', 'silver_key': 'üóùÔ∏è Silver Key',
    'lib_1': 'üìñ Dust Hint', 'lib_2': 'üìú Cipher', 'lib_clue': 'üó∫Ô∏è Secret Map',
    'kit_1': 'üçΩÔ∏è Tray Detail', 'kit_2': 'üß™ Poison Info', 'kitchen_clue': 'üî¨ Chemical Trace',
    'trust': 'ü§ù Trust', 'code': 'üî¢ Cabinet Code', 'diary_unlocked': 'üìì Elizabeth\'s Diary',
    'cell_key': 'üîë Cell Key', 'truth': '‚ú® The Truth'
};


        function playSound(id) {
            const audio = document.getElementById(id);
            if (audio) { audio.currentTime = 0; audio.play().catch(e => {}); }
        }

        function updateStatus() {
            document.getElementById('score-display').innerText = `Score: ${score} points`;
            const items = Array.from(inventory).map(id => itemNames[id] || id).join(', ');
            document.getElementById('inventory-display').innerText = `Inventory: ${items || 'empty'}`;
        }

        function startGame() {
            document.getElementById('start-screen').style.display = 'none';
            document.getElementById('game-container').style.display = 'block';
            const music = document.getElementById('bgMusic');
            if (music) { music.volume = 0.15; music.play(); }
            renderScene('scene1');
        }

     const scenes = {
    // --- –ì–õ–ê–í–ê 1: –ü–†–ò–ë–´–¢–ò–ï (3 –∑–∞–¥–∞–Ω–∏—è) ---
    scene1: {
        title: 'The Iron Gates',
        text: 'The manor looms ahead. You stand before the massive gates. You must <b>find out</b> what happened here.',
        task: { question: 'Task 1: Synonym for "find out":', options: ['Discover', 'Ignore'], correct: 'Discover', reward: 'gate_1' },
        media: '<img src="assets/gates.png" class="clue-img">',
        choices: [{ text: 'Examine the Lock', next: 'scene1_task2', require: 'gate_1' }]
    },
    scene1_task2: {
        title: 'The Gate Mechanism',
        text: 'The lock is rusted. "It ____ (not/open) for years," you observe.',
        task: { question: 'Task 2: Passive Voice:', options: ['hasn\'t been opened', 'wasn\'t open'], correct: 'hasn\'t been opened', reward: 'gate_2' },
        media: '<img src="assets/gates.png" class="clue-img">',
        choices: [{ text: 'Check the Plaque', next: 'scene1_task3', require: 'gate_2' }]
    },
    scene1_task3: {
        title: 'The Private Plaque',
        text: 'The plaque says: "Visitors are requested to ring the bell."',
        task: { question: 'Task 3: Meaning of "are requested":', options: ['Asked formally', 'Forced'], correct: 'Asked formally', reward: 'gate_clue' },
        media: '<img src="assets/gates.png" class="clue-img">',
        choices: [
            { text: 'Search the Garden', next: 'scene_garden', require: 'gate_clue' },
            { text: 'Use Radio Hint', next: 'scene_radio', require: 'gate_clue' }
        ]
    },

    scene_radio: {
        title: 'Radio Message',
        text: 'Static noise... "Detective... check the garden roses."',
        onEnter: () => playSound('radioSound'),
        media: '<video src="assets/radio-scene.mp4" autoplay loop muted class="clue-img"></video>',
        choices: [{ text: 'Go to the Garden', next: 'scene_garden' }]
    },

    // --- –ì–õ–ê–í–ê 2: –°–ê–î –ò –ö–û–†–û–ë–ö–ê (3 –∑–∞–¥–∞–Ω–∏—è) ---
    scene_garden: {
        title: 'The Silent Garden',
        text: 'Among the withered roses, you see a concealed wooden box.',
        task: { question: 'Task 1: What does "concealed" mean?', options: ['Hidden', 'Broken'], correct: 'Hidden', reward: 'garden_1' },
        media: '<img src="assets/garden.png" class="clue-img">',
        choices: [{ text: 'Examine the Box', next: 'scene_box_task', require: 'garden_1' }]
    },
    scene_box_task: {
        title: 'The Puzzle Box - Layer 1',
        text: '"If I ____ (be) you, I wouldn\'t touch that."',
        task: { question: 'Task 2: Second Conditional:', options: ['were', 'am'], correct: 'were', reward: 'box_1' },
        media: '<img src="assets/box.png" class="clue-img">',
        choices: [{ text: 'Next Layer', next: 'scene_box_task2', require: 'box_1' }]
    },
    scene_box_task2: {
        title: 'The Puzzle Box - Layer 2',
        text: '"The key ____ (hide) here by Elizabeth."',
        task: { question: 'Task 3: Passive Deduction:', options: ['must have been hidden', 'was hiding'], correct: 'must have been hidden', reward: 'silver_key' },
        media: '<img src="assets/box.png" class="clue-img">',
        choices: [{ text: 'Enter the Hall', next: 'scene2_hall', require: 'silver_key' }]
    },

    // --- –ì–õ–ê–í–ê 3: –•–û–õ–õ –ò –£–õ–ò–ö–ò (–ë–∏–±–ª–∏–æ—Ç–µ–∫–∞/–ö—É—Ö–Ω—è –ø–æ 3 –∑–∞–¥–∞–Ω–∏—è) ---
    scene2_hall: {
        title: 'The Grand Hall',
        text: 'The manor is cold. Where will you investigate first?',
        media: '<video src="assets/hall-intro.mp4" autoplay loop muted class="clue-img"></video>',
        choices: [
            { text: 'Go to Library', next: 'scene_library' },
            { text: 'Check Kitchen', next: 'scene_kitchen' },
            { text: 'Talk to Housekeeper', next: 'scene_housekeeper' },
            { text: 'Examine Portrait', next: 'scene_portrait_secret', require: 'trust' }
        ]
    },

    scene_library: {
        title: 'The Library',
        text: 'The room ____ (not/touch) for years.',
        task: { question: 'Task 1: Passive Voice:', options: ['had not been touched', 'has not touched'], correct: 'had not been touched', reward: 'lib_1' },
        media: '<img src="assets/library.png" class="clue-img">',
        choices: [{ text: 'Read Note', next: 'scene_library_2', require: 'lib_1' }]
    },
    scene_library_2: {
        title: 'The Library - Note',
        text: '"If Sir Henry ____ (be) more careful, he wouldn\'t be missing."',
        task: { question: 'Task 2: Mixed Conditional:', options: ['had been', 'was'], correct: 'had been', reward: 'lib_2' },
        media: '<img src="assets/library.png" class="clue-img">',
        choices: [{ text: 'Analyze Map', next: 'scene_library_3', require: 'lib_2' }]
    },
    scene_library_3: {
        title: 'The Library - Map',
        text: 'The map shows a trapdoor. It ____ (locate) under the desk.',
        task: { question: 'Task 3: Present Passive:', options: ['is located', 'locates'], correct: 'is located', reward: 'lib_clue' },
        media: '<img src="assets/library.png" class="clue-img">',
        choices: [{ text: 'Back to Hall', next: 'scene2_hall', require: 'lib_clue' }]
    },

    scene_kitchen: {
        title: 'The Kitchen',
        text: 'Dinner ____ (prepare) when the crime occurred.',
        task: { question: 'Task 1: Passive Continuous:', options: ['was being prepared', 'was preparing'], correct: 'was being prepared', reward: 'kit_1' },
        media: '<img src="assets/kitchen.png" class="clue-img">',
        choices: [{ text: 'Examine Cup', next: 'scene_kitchen_2', require: 'kit_1' }]
    },
    scene_kitchen_2: {
        title: 'The Kitchen - Tea',
        text: 'The tea smells of almonds. It ____ (poison).',
        task: { question: 'Task 2: Modal Deduction:', options: ['must have been poisoned', 'should be poisoned'], correct: 'must have been poisoned', reward: 'kit_2' },
        media: '<img src="assets/kitchen.png" class="clue-img">',
        choices: [{ text: 'Identify Poison', next: 'scene_kitchen_3', require: 'kit_2' }]
    },
    scene_kitchen_3: {
        title: 'The Kitchen - Label',
        text: 'A bottle says: "Handle with care. Not ____ (use) by staff."',
        task: { question: 'Task 3: Passive Infinitive:', options: ['to be used', 'to use'], correct: 'to be used', reward: 'kitchen_clue' },
        media: '<img src="assets/kitchen.png" class="clue-img">',
        choices: [{ text: 'Back to Hall', next: 'scene2_hall', require: 'kitchen_clue' }]
    },

    // --- –ì–õ–ê–í–ê 4: –§–ò–ù–ê–õ (–ü–æ–¥–≤–∞–ª/–ß–µ—Ä–¥–∞–∫ –ø–æ 3 –∑–∞–¥–∞–Ω–∏—è) ---
    scene_housekeeper: {
        title: 'The Housekeeper',
        text: '"Sir Henry ____ (watch) us for years!"',
        task: { question: 'Task 1: Present Perfect Continuous:', options: ['has been watching', 'is watching'], correct: 'has been watching', reward: 'trust' },
        media: '<img src="assets/housekeeper.png" class="clue-img">',
        choices: [{ text: 'Back to Hall', next: 'scene2_hall', require: 'trust' }]
    },
    scene_portrait_secret: {
        title: 'The Hidden Keypad',
        text: '"He must ____ (be) rich to afford this."',
        task: { question: 'Task 1: Modal Deduction (Past):', options: ['have been', 'had been'], correct: 'have been', reward: 'code' },
        media: '<img src="assets/sir-henry.jpg" class="clue-img">',
        choices: [{ text: 'Open Study', next: 'scene_study', require: 'code' }]
    },
    scene_study: {
        title: 'The Study',
        text: 'You find Elizabeth\'s diary.',
        media: '<img src="assets/study.png" class="clue-img">',
        choices: [{ text: 'Listen to Diary', next: 'scene_diary' }]
    },
    scene_diary: {
        title: 'The Diary',
        text: 'Elizabeth says she ____ (hide) for hours.',
        onEnter: () => playSound('diary-voice'),
        task: { question: 'Task 1: Listening Task:', options: ['has been hiding', 'hides'], correct: 'has been hiding', reward: 'diary_unlocked' },
        media: '<img src="assets/diary-mystical.png" class="clue-img">',
        choices: [{ text: 'Find Trapdoor', next: 'scene_trapdoor', require: 'lib_clue' }]
    },
    scene_trapdoor: {
        title: 'The Trapdoor',
        text: 'A hidden passage.',
        media: '<img src="assets/trapdoor.png" class="clue-img">',
        choices: [{ text: 'Go to Basement', next: 'scene_basement' }]
    },
    scene_basement: {
        title: 'The Basement',
        text: 'Suddenly, a door slams!',
        media: '<img src="assets/basement.png" class="clue-img">',
        choices: [{ text: 'Who is there?', next: 'scene_caretaker' }]
    },
    scene_caretaker: {
        title: 'The Caretaker',
        text: '"I wish you ____ (not/find) this place."',
        task: { question: 'Task 1: Wish (Past):', options: ['hadn\'t found', 'didn\'t find'], correct: 'hadn\'t found', reward: 'cell_key' },
        media: '<img src="assets/caretaker.png" class="clue-img">',
        choices: [{ text: 'Go to Attic', next: 'scene_attic', require: 'cell_key' }]
    },
    scene_attic: {
        title: 'The Attic',
        text: 'You see Elizabeth.',
        onEnter: () => playSound('footsteps'),
        media: '<img src="assets/attic.png" class="clue-img">',
        choices: [{ text: 'Approach her', next: 'scene_elizabeth_reveal' }]
    },
    scene_elizabeth_reveal: {
        title: 'Elizabeth',
        text: '"Detective! I ____ (wait) for you. We must leave!"',
        task: { question: 'Task 1: Tense:', options: ['have been waiting', 'am waiting'], correct: 'have been waiting', reward: 'truth' },
        media: '<img src="assets/elizabeth.png" class="clue-img">',
        choices: [{ text: 'FINISH EPISODE I', next: 'scene_final', require: 'truth' }]
    },
    scene_final: { title: 'To Be Continued', text: 'Episode II coming soon.', choices: [{ text: 'Restart', next: 'scene1' }] }
};



        function renderScene(sceneId) {
            const scene = scenes[sceneId];
            if (!scene) return;
            const choiceBox = document.getElementById('choices-container');
            choiceBox.innerHTML = '';
            document.getElementById('scene-title').innerText = scene.title;
            document.getElementById('scene-text').innerHTML = scene.text;
            document.getElementById('media-container').innerHTML = scene.media || '';
            if (scene.onEnter) scene.onEnter();
            updateStatus();
            if (scene.task && !inventory.has(scene.task.reward)) {
                renderTask(scene.task, choiceBox, sceneId);
            } else {
                scene.choices.forEach(c => {
                    if (!c.require || inventory.has(c.require)) {
                        const b = document.createElement('button');
                        b.innerText = c.text; b.className = 'choice-btn';
                        b.onclick = () => { playSound('uiClick'); renderScene(c.next); };
                        choiceBox.appendChild(b);
                    }
                });
            }
        }

        function renderTask(task, container, sceneId) {
            const p = document.createElement('p'); p.className = 'task-question';
            p.innerHTML = `TASK: ${task.question}`; container.appendChild(p);
            task.options.forEach(opt => {
                const b = document.createElement('button');
                b.innerText = opt; b.className = 'choice-btn';
                b.onclick = () => {
                    playSound('uiClick');
                    if (opt === task.correct) { inventory.add(task.reward); score += 10; renderScene(sceneId); }
                    else { alert("Try again!"); }
                };
                container.appendChild(b);
            });
        }
    </script>
</body>
</html>
